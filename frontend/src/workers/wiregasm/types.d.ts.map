{"mappings":"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","sources":["src/src/types.ts","src/src/utils.ts","src/src/index.ts","src/index.ts"],"sourcesContent":[null,null,null,"import {\n  BeforeInitCallback,\n  CheckFilterResponse,\n  CompleteField,\n  DissectSession,\n  Follow,\n  Frame,\n  FramesResponse,\n  LoadResponse,\n  WiregasmLib,\n  WiregasmLibOverrides,\n  WiregasmLoader,\n} from \"./types\";\n\nimport { vectorToArray } from \"./utils\";\n\n/**\n * Wraps the WiregasmLib lib functionality and manages a single DissectSession\n */\nexport class Wiregasm {\n  lib: WiregasmLib;\n  initialized: boolean;\n  session: DissectSession | null;\n  uploadDir: string;\n  pluginsDir: string;\n\n  constructor() {\n    this.initialized = false;\n    this.session = null;\n  }\n\n  /**\n   * Initialize the wrapper and the Wiregasm module\n   *\n   * @param loader Loader function for the Emscripten module\n   * @param overrides Overrides\n   */\n  async init(\n    loader: WiregasmLoader,\n    overrides: WiregasmLibOverrides = {},\n    beforeInit: BeforeInitCallback = null\n  ) {\n    if (this.initialized) {\n      return;\n    }\n\n    this.lib = await loader(overrides);\n    this.uploadDir = this.lib.getUploadDirectory();\n    this.pluginsDir = this.lib.getPluginsDirectory();\n\n    if (beforeInit !== null) {\n      await beforeInit(this.lib);\n    }\n\n    this.lib.init();\n    this.initialized = true;\n  }\n\n  /**\n   * Check the validity of a filter expression.\n   *\n   * @param filter A display filter expression\n   */\n  test_filter(filter: string): CheckFilterResponse {\n    return this.lib.checkFilter(filter);\n  }\n\n  complete_filter(filter: string): { err: string; fields: CompleteField[] } {\n    const out = this.lib.completeFilter(filter);\n    return {\n      err: out.err,\n      fields: vectorToArray(out.fields),\n    };\n  }\n\n  reload_lua_plugins() {\n    this.lib.reloadLuaPlugins();\n  }\n\n  add_plugin(name: string, data: string | ArrayBufferView, opts: object = {}) {\n    const path = this.pluginsDir + \"/\" + name;\n    this.lib.FS.writeFile(path, data, opts);\n  }\n\n  /**\n   * Load a packet trace file for analysis.\n   *\n   * @returns Response containing the status and summary\n   */\n  load(\n    name: string,\n    data: string | ArrayBufferView,\n    opts: object = {}\n  ): LoadResponse {\n    if (this.session != null) {\n      this.session.delete();\n    }\n\n    const path = this.uploadDir + \"/\" + name;\n    this.lib.FS.writeFile(path, data, opts);\n\n    this.session = new this.lib.DissectSession(path);\n\n    return this.session.load();\n  }\n\n  /**\n   * Get Packet List information for a range of packets.\n   *\n   * @param filter Output those frames that pass this filter expression\n   * @param skip Skip N frames\n   * @param limit Limit the output to N frames\n   */\n  frames(filter: string, skip = 0, limit = 0): FramesResponse {\n    return this.session.getFrames(filter, skip, limit);\n  }\n\n  /**\n   * Get full information about a frame including the protocol tree.\n   *\n   * @param number Frame number\n   */\n  frame(num: number): Frame {\n    return this.session.getFrame(num);\n  }\n\n  follow(follow: string, filter: string): Follow {\n    return this.session.follow(follow, filter);\n  }\n\n  destroy() {\n    if (this.initialized) {\n      if (this.session !== null) {\n        this.session.delete();\n        this.session = null;\n      }\n\n      this.lib.destroy();\n      this.initialized = false;\n    }\n  }\n\n  /**\n   * Returns the column headers\n   */\n  columns(): string[] {\n    const vec = this.lib.getColumns();\n\n    // convert it from a vector to array\n    return vectorToArray(vec);\n  }\n}\n\nexport * from \"./types\";\nexport * from \"./utils\";\n"],"names":[],"version":3,"file":"types.d.ts.map"}